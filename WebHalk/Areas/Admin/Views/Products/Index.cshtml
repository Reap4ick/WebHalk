@using WebHalk.Helpers
@model WebHalk.Areas.Admin.Models.Products.PaginatedList<WebHalk.Areas.Admin.Models.Products.ProductItemViewModel>

@{
    ViewData["Title"] = "Продукти";
    var searchString = ViewData["SearchString"] as string;
    var categoryFilter = ViewData["CategoryFilter"] as string;
    var pageSize = (int)(ViewData["PageSize"] ?? 10);
    var categories = ViewData["Categories"] as IEnumerable<WebHalk.Areas.Admin.Models.Category.CategoryItemViewModel>; // Adjust the type
}

<!-- Пошук і фільтрація -->
<form method="get" class="mb-4">
    <div class="row">
        <div class="col-md-4">
            <div class="form-group">
                <label for="searchString">Пошук:</label>
                <input type="text" id="searchString" name="searchString" value="@searchString" class="form-control" placeholder="Введіть назву продукту" />
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group">
                <label for="categoryFilter">Категорія:</label>
                @Html.CategoryDropDown(categories, string.IsNullOrEmpty(categoryFilter) ? (int?)null : int.Parse(categoryFilter))
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group">
                <label for="pageSize">Кількість на сторінці:</label>
                @Html.PageSizeDropDown(pageSize)
            </div>
        </div>
    </div>
</form>

<!-- Перевірка на null для моделі -->
@if (Model == null || !Model.Items.Any())
{
    <p>Дані не знайдено.</p>
}
else
{
    <!-- Таблиця з продуктами -->
    <table class="table">
        <thead>
            <tr>
                <th>Назва</th>
                <th>Ціна</th>
                <th>Редагувати</th>
                <th>Дії</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Items)
            {
                <tr>
                    <td>@item.Name</td>
                    <td>@item.Price</td>
                    <td>
                        <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-outline-secondary btn-sm">
                            <i class="bi bi-pencil"></i>
                        </a>
                    </td>
                    <td>
                        <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal-@item.Id">
                            <i class="bi bi-trash"></i>
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <!-- Модальне вікно для підтвердження видалення -->
    @foreach (var item in Model.Items)
    {
        <div class="modal fade" id="deleteModal-@item.Id" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel-@item.Id">Видалити товар</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Ви впевнені, що хочете видалити "@item.Name"?</p>
                        <form method="post" asp-action="Delete">
                            <input type="hidden" name="id" value="@item.Id" />
                            <button type="submit" class="btn btn-danger">Видалити</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Скасувати</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Пагінація -->
    <div class="d-flex justify-content-between">
        @if (Model.HasPreviousPage)
        {
            <a class="btn btn-primary" href="?pageNumber=@(Model.PageIndex - 1)&pageSize=@pageSize&searchString=@searchString&categoryFilter=@categoryFilter">
                Попередня
            </a>
        }
        @if (Model.HasNextPage)
        {
            <a class="btn btn-primary" href="?pageNumber=@(Model.PageIndex + 1)&pageSize=@pageSize&searchString=@searchString&categoryFilter=@categoryFilter">
                Наступна
            </a>
        }
    </div>
}

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var categories = @Html.Raw(Json.Serialize(ViewData["Categories"]));
            var select = document.getElementById('categoryFilter');

            categories.forEach(function (category) {
                var option = document.createElement('option');
                option.value = category.Id;
                option.text = category.Name;
                if (category.Id.toString() === '@categoryFilter') {
                    option.selected = true;
                }
                select.add(option);
            });
        });
    </script>
}
